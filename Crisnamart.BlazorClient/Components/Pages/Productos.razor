@page "/productos"
@inject IHttpClientFactory HttpClientFactory

<h3>Catálogo de Productos</h3>

@if (productos == null) {
	<p>Cargando productos...</p>
} else {
	<div class="row">
		@foreach (Producto p in productos) {
			<div class="col-3 mb-4">
				<div class="card">
					<img src="@p.BrowserUrl" class="card-img-top" />
					<div class="card-body">
						<h6>@p.Descripcion</h6>
						<small>@p.CodigoUnico</small>
					</div>
				</div>
			</div>
		}
	</div>
}

@code {
	private List<Producto>? productos;

	protected override async Task OnInitializedAsync() {
		var http = HttpClientFactory.CreateClient("ApiClient");
		productos = await http.GetFromJsonAsync<List<Producto>>("api/productos");
	}

	public class Producto {
		public string CodigoUnico { get; set; } = "";
		public string Ruta { get; set; } = "";
		public string Descripcion { get; set; } = "";
		public string BrowserUrl {
			get {
				var segments = Ruta.Split('/', '\\'); // handle both separators
				var encodedSegments = segments.Select(Uri.EscapeDataString);
				return "/images/" + string.Join("/", encodedSegments);
			}
		}
	}
}
